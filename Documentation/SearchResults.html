<!DOCTYPE html>

<!-- This is the page that shows up after you perform a search -->

<style>
	
	.searchResultsListElement
	{
		list-style-type: none;	
	}
	
</style>


<html>
    <head>
        <title>UE4 RTS Search Results</title> 
    </head>
            
    <body>
        <h1>Search Results</h1>
        <ul id="searchResultsList" class="searchResultsList">
            
        </ul>
    </body>
</html>

<script>
    
    /* Probably don't want this function to be called on refresh. Is that the case? */
    window.onload = function() 
    {
        var whatUserSearchedFor = window.localStorage.getItem("searchText");
        onWindowLoad(whatUserSearchedFor);
    }
    
    /* @param searchText - what the user searched for */
    function onWindowLoad(searchText)
    {
        //processSearchRequest(searchText);
	    processSearchRequest("ANN ***    	((ASDMK M   aAAA MM     $$$$ a    )"); // Just for testing TODO
    }
    
    function processSearchRequest(searchText)
    {
        var linksToShow = getSearchResults(searchText);
        
        for (var i = 0; i < linksToShow.length; ++i)
        {
            createSearchResultHTMLElement(linksToShow[i]);
        }
    }
    
    /* @param filename - the path of the file relative to the folder that stores all my auto-generated files in */
    function createSearchResultHTMLElement(filePath)
    {
        /* Prune filePath and html part e.g. "Classes/ABuilding.html" becomes "ABuilding" */
        var niceName = filePath;
        for (var i = niceName.length - 1; i >= 0; --i)
        {
            if (niceName.charAt(i) == ".")
            {
                // Remove the ".html" part
                niceName = niceName.substring(0, i);
            }
            else if (niceName.charAt(i) == "\/")
            {
                // Remove the "Classes/" part
                niceName = niceName.substring(i + 1, niceName.length);
                break;
            }
        }
        
	/* Create list elements to display the search results */
	    
    var li = document.createElement("li");
	li.setAttribute("class", "searchResultsListElement");
    var div1 = document.createElement("div");
	var a = document.createElement("a");
    a.setAttribute("href", "Info/" + filePath);
    a.appendChild(document.createTextNode(niceName));
	div1.appendChild(a);
	    
	// Add another text field that will show the class'/struct's/enum's comment 
    var div2 = document.createElement("div");
	div2.appendChild(document.createTextNode(getSearchResultDescription(niceName)));
		
	li.appendChild(div1);
	li.appendChild(div2);

	var ul = document.getElementById("searchResultsList");
	ul.appendChild(li);
    }
    
    /* Return array of filenames to show for a search request. Lower indicies in the array will appear 
    higher up on the page */
    function getSearchResults(searchText)
    {
	// Array of search results to return
        var array = [];
        
        //TODO
        array.push("Classes/something1.html");
        array.push("Classes/building.html");
        array.push("Classes/infantry.html");
        
	// ------- Begin my attempt at returning correct results --------
	
	/* 
		Brainstorm:
		- comments probably aren't going to be considered in the search - only the actual names of the classes/variables etc
		- first check how many words the user entered e.g. if they typed "building health damage" that's 3 words 
		- for each word perform a search through a trie 
		- for each 2 words perform a search through a trie 
		- lastly do all 3 words 
		- when doing the single word searches when I reach the end of them in the trie then the end node should link 
		to somthing that then has a
	*/
	
	var str = searchText;

	// Remove whitespace from start and end
	str = str.trim();
	    
	/* Remove unuseful characters from the search request. Haven't really tested this but I want it to remove 
	things like #, @, %, etc basically just leave letters and digits */
	str = str.replace(/[^\w\s]/gi, "");
	
	/* Replace 2+ runs of witespace with a single space */
    	str = str.replace(/\s\s+/g, " ");
	    
	/* Parse the string and split it up into seperate words */
	var tokens = [];
	for (var i = str.length - 1; i >= 0; --i)
	{
		if (str.charAt(i) == " ")
		{
			var token = str.substring(i + 1, str.length);
			tokens.push(token);
			str = str.substring(0, i);
		}
		else if (i == 0)
		{
			var token = str.substring(i + 1, str.length);
			tokens.push(token);
			str = str.substring(0, i);
		}
	}
	
	    // Begin debug code
	for (var i = 0; i < tokens.length; ++i)
	{
		console.log(tokens[i]);	
	}
	    // End debug code
	    
        return array;
    }
	
    /** 
	 *	@param name - the name of the item e.g. "ABuilding", "EUnitType" 
	 *	@return - the description to show for name when it is a search result 
	 */
	function getSearchResultDescription(name)
	{
		return "BLAH BLAH BLAH BLAH BLAH BLAH BLAH BLAH BLAH BLAH BLAH BLAH BLAH BLAH BLAH BLAH sjdask lasldlsaldad;sal; " 
		+ "dsadsak uuuuuuuuu roqwpeqp rpeprpepepeppe ee[[q[[qq[q[q[ lalaskdlklaskldlsad";
	}
    
</script>


